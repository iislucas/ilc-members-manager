@let u = user();
@if (loading() || !u) {
  <app-spinner></app-spinner>
} @else if (error()) {
  <div class="error-container">
    <span class="error-message">{{ error() }}</span>
  </div>
} @else {
  <div class="search-header">
    <div class="search-box">
      <app-icon class="search-icon" name="search"></app-icon>
      <input
        type="text"
        placeholder="Search members by name, member ID, email, or city..."
        (input)="onSearch($event)"
      />
    </div>
    @if (canMakeNewMembers()) {
      <button (click)="onNewMember()">New Member</button>
    }
  </div>

  @if (errorsExist()) {
    <div class="error-box">
      <div class="error-box-header" (click)="toggleErrors()">
        <app-icon
          [name]="showErrors() ? 'expand_more' : 'expand_less'"
        ></app-icon>
        <span
          >There are entries with duplicate IDs ({{
            duplicateEntries().length
          }})</span
        >
      </div>
      @if (showErrors()) {
        <div class="error-box-content">
          <p class="error-hint">
            Please resolve these duplicate IDs to ensure data integrity.
          </p>
          <div class="member-cards">
            @for (member of duplicateEntries(); track member.id) {
              <div class="member-card duplicate">
                <app-member-edit
                  [member]="member"
                  [allMembers]="members()"
                ></app-member-edit>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
  <div class="member-cards">
    @if (isAddingMember()) {
      <div class="member-card">
        <app-member-edit
          [member]="newMember()"
          [allMembers]="members()"
          [collapse]="false"
          (close)="onNewMemberClose()"
          [canDelete]="false"
        ></app-member-edit>
      </div>
    }
    @if (!u.isAdmin) {
      <div class="member-card">
        <app-member-edit
          [member]="u.member"
          [allMembers]="members()"
        ></app-member-edit>
      </div>
    }
    @let membersList = members();
    @for (member of membersList; track member.id) {
      <div class="member-card">
        <app-member-edit
          [member]="member"
          [allMembers]="members()"
        ></app-member-edit>
      </div>
    }
  </div>
}
