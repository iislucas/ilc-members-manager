<div class="edit-form">
  <form #memberForm="ngForm" (ngSubmit)="saveMember()">
    <div class="form-section">
      <h3>Contact Information</h3>
      <label for="name">Name</label>
      <div>
        <input
          class="long"
          type="text"
          id="name"
          name="name"
          [(ngModel)]="editableMember.name"
          #name="ngModel"
          required
        />
        @if(name.invalid) {
        <div class="error">Name is required.</div>
        }
      </div>

      <label for="email">Email</label>
      <div>
        <input
          class="long"
          type="email"
          id="email"
          name="email"
          [(ngModel)]="editableMember.email"
          (ngModelChange)="isDupEmail()"
          #email="ngModel"
          required
          email
        />
        @if (emailExists) {
        <div class="error">This email address is already in use.</div>
        } @else if (email.invalid) {
        <div class="error">Please enter a valid email address.</div>
        }
      </div>

      <label for="address" class="align-top">Address</label>
      <textarea
        class="long"
        id="address"
        name="address"
        [(ngModel)]="editableMember.address"
      ></textarea>

      <label for="city">City</label>
      <input
        type="text"
        id="city"
        name="city"
        [(ngModel)]="editableMember.city"
      />

      <label for="zipCode">Zip Code</label>
      <input
        type="text"
        id="zipCode"
        name="zipCode"
        [(ngModel)]="editableMember.zipCode"
      />

      <label for="country">Country</label>
      <input
        type="text"
        id="country"
        name="country"
        [(ngModel)]="editableMember.country"
      />

      <label for="phone">Phone</label>
      <input
        type="text"
        id="phone"
        name="phone"
        [(ngModel)]="editableMember.phone"
      />

      <h3>ILC Member Information</h3>
      <label for="memberId">Member ID</label>
      <div>
        <input
          type="text"
          id="memberId"
          name="memberId"
          [(ngModel)]="editableMember.memberId"
          (ngModelChange)="isDupMemberId()"
          #memberId="ngModel"
          [required]="editableMember.id !== ''"
        />
        @if(memberId.invalid) {
        <div class="error">Member ID is required.</div>
        } @else if(memberIdExists) {
        <div class="error">This member ID is already in use.</div>
        }
      </div>

      <label for="membershipType">Membership Type</label>
      <input
        type="text"
        id="membershipType"
        name="membershipType"
        [(ngModel)]="editableMember.membershipType"
      />

      <label for="membershipExpires">Membership Expires</label>
      <input
        class="date"
        type="date"
        id="membershipExpires"
        name="membershipExpires"
        placeholder="YYYY-MM-DD"
        [ngModel]="editableMember.membershipExpires"
        (ngModelChange)="editableMember.membershipExpires = $event"
      />

      <label for="sifuMemberId">Sifu Member ID</label>
      <input
        type="text"
        id="sifuMemberId"
        name="sifuMemberId"
        [(ngModel)]="editableMember.sifuMemberId"
      />

      <h3>Level Information</h3>
      <label for="studentLevel">Student Level</label>
      <input
        type="text"
        id="studentLevel"
        name="studentLevel"
        [(ngModel)]="editableMember.studentLevel"
      />

      <label for="applicationLevel">Application Level</label>
      <input
        type="text"
        id="applicationLevel"
        name="applicationLevel"
        [(ngModel)]="editableMember.applicationLevel"
      />

      <label for="mastersLevels">Masters Levels</label>
      <input
        type="text"
        id="mastersLevels"
        name="mastersLevels"
        [(ngModel)]="editableMember.mastersLevels"
      />

      <h3>Instructor Information</h3>
      <label for="instructorId">Instructor ID</label>
      <input
        type="text"
        id="instructorId"
        name="instructorId"
        [(ngModel)]="editableMember.instructorId"
      />

      <label for="instructorLicenseExpires">Instructor License Expires</label>
      <input
        class="date"
        type="date"
        id="instructorLicenseExpires"
        name="instructorLicenseExpires"
        placeholder="YYYY-MM-DD"
        [ngModel]="editableMember.instructorLicenseExpires"
        (ngModelChange)="editableMember.instructorLicenseExpires = $event"
      />

      <label for="instructorWebsite">Instructor Website</label>
      <input
        class="long"
        type="text"
        id="instructorWebsite"
        name="instructorWebsite"
        [(ngModel)]="editableMember.instructorWebsite"
      />

      <label for="instructorSchoolId">Instructor School ID</label>
      <input
        type="text"
        id="instructorSchoolId"
        name="instructorSchoolId"
        [(ngModel)]="editableMember.instructorSchoolId"
      />

      <h3>School Information</h3>
      <label for="schoolIdManaged">School ID Managed</label>
      <input
        class="long"
        type="text"
        id="schoolIdManaged"
        name="schoolIdManaged"
        [(ngModel)]="editableMember.schoolIdManaged"
      />

      <h3>Country Manager</h3>
      <label for="countryManaged">Country Managed</label>
      <input
        class="long"
        type="text"
        id="countryManaged"
        name="countryManaged"
        [(ngModel)]="editableMember.countryManaged"
      />

      <h3>Admin</h3>
      <label for="isAdmin">Is Admin</label>
      <div class="admin-section">
        <input
          type="checkbox"
          id="isAdmin"
          name="isAdmin"
          [(ngModel)]="editableMember.isAdmin"
        />
        (can edit all members)
      </div>
    </div>

    @if (errorMessage()) {
    <div class="error-container">
      <div class="error-message">
        {{ errorMessage() }}
        <button class="close-button" (click)="closeError()">
          <app-icon name="close" />
        </button>
      </div>
    </div>
    }
    <div class="form-actions">
      @if(isSaving()) {
      <app-spinner></app-spinner>
      } @else {
      <button
        type="submit"
        [disabled]="emailExists || memberIdExists || memberForm.invalid"
      >
        Save
      </button>

      <button type="button" (click)="cancel($event)">Cancel</button>
      @if(canDelete()) {
      <button class="delete-button" (click)="deleteMember($event)">
        <app-icon name="trash" fill="white" />
        Delete
      </button>
      } }
    </div>
  </form>
</div>
