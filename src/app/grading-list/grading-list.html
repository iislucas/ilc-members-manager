@let u = user();
@if (loading() || !u) {
<app-spinner></app-spinner>
} @else if (error()) {
<div class="error-container">
  <span class="error-message">{{ error() }}</span>
</div>
} @else {
@if (viewMode() === 'instructor') {
<div class="tabs">
  <button class="tab-button" [class.active]="activeTab() === 'examined'" (click)="setActiveTab('examined')">Gradings
    Examined</button>
  <button class="tab-button" [class.active]="activeTab() === 'students'" (click)="setActiveTab('students')">My Students
    Gradings</button>
</div>
}

<div class="search-header">
  <div class="search-box">
    <app-icon class="search-icon" name="search"></app-icon>
    <input type="text" placeholder="Search gradings by student, instructor, status, or level..."
      (input)="onSearch($event)" />
  </div>
  @if (canMakeNewGradings()) {
  <button (click)="onNewGrading()">New Grading</button>
  }
</div>

<div class="grading-cards">
  @if (isAddingGrading()) {
    <app-grading-edit [grading]="newGrading()" [collapse]="false" (close)="onNewGradingClose()"
      [canDelete]="false"></app-grading-edit>
  }

  @let gradingsList = gradings();
  @for (grading of gradingsList; track grading.id) {
    @if (viewMode() === 'instructor' ? activeTab() === 'students' : isStudentGrading(grading)) {
    <div class="student-grading-alert">
        <app-grading-edit [grading]="grading"></app-grading-edit>
      </div>
      } @else {
      <app-grading-edit [grading]="grading"></app-grading-edit>
      }
  }
  @if (gradingsList.length < totalGradings()) { <div class="show-more-container">
    <button class="show-more-button" (click)="showAll()">
      Show all {{ totalGradings() }} gradings
    </button>
</div>
}
@if (gradingsList.length === 0 && !isAddingGrading()) {
<div class="empty-state">
  <p>No gradings found.</p>
</div>
}
</div>
}