<div class="mapping-table">
  <h3>Map Fields</h3>
  <p>
    Verify that the columns in your file match the correct fields. You can
    map multiple CSV headers to a single field (e.g. First Name + Last Name → name).
  </p>

  <div class="example-navigation">
    <button (click)="prevExample()" [disabled]="currentExampleIndex() === 0">
      Previous Example
    </button>
    <span>
      Row {{ currentExampleIndex() + 1 }} of {{ parsedData().length }}
    </span>
    <button (click)="nextExample()" [disabled]="currentExampleIndex() === parsedData().length - 1">
      Next Example
    </button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>CSV/JSONL Headers</th>
        <th>Example Value</th>
      </tr>
    </thead>
    <tbody>
      @for (field of fieldsToMap(); track field) {
      <tr>
        <td>{{ field }}</td>
        <td class="headers-cell">
          @if (mapping()[field]; as mapped) {
          @for (header of mapped; track header) {
          <span class="header-chip">
            {{ header }}
            <button class="remove-btn" (click)="removeHeader(field, header)" title="Remove">×</button>
          </span>
          }
          }
          <select (change)="addHeader(field, $event)">
            <option value="">+ Add header</option>
            @for (header of headers(); track header) {
            <option [value]="header">{{ header }}</option>
            }
          </select>
        </td>
        <td>
          @if (mapping()[field]?.length) {
          {{ getExampleValue(field) }}
          } @else {
          <span class="no-mapping">--</span>
          }
        </td>
      </tr>
      }
    </tbody>
  </table>
  <div class="stage-actions">
    <button class="primary" (click)="analyze.emit()">Next: Analyze Changes</button>
  </div>
</div>