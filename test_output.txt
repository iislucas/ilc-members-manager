
> ilc-members-manager@0.0.0 test /Users/lucasd/code/ilc-members-manager
> pnpm test:once


> ilc-members-manager@0.0.0 test:once /Users/lucasd/code/ilc-members-manager
> vitest run --no-color


 RUN  v4.0.18 /Users/lucasd/code/ilc-members-manager

 âœ“ src/app/import-export/import-mapping/import-mapping.spec.ts (1 test) 190ms
 âœ“ src/app/id-assignment/id-assignment.spec.ts (1 test) 244ms
 âœ“ src/app/find-school/find-school.spec.ts (2 tests) 161ms
 âœ“ src/app/find-an-instructor/find-an-instructor.spec.ts (1 test) 111ms
 âœ“ src/app/calendar-view/calendar-view.spec.ts (1 test) 167ms
 âœ“ src/app/autocomplete/autocomplete.spec.ts (1 test) 79ms
 âœ“ src/app/school-edit/school-edit.spec.ts (4 tests) 269ms
 âœ“ src/app/routing.service.spec.ts (4 tests) 38ms
stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should be created
FirebaseStateService: Persistence set to browserLocalPersistence

 âœ“ src/app/member-list/member-list.spec.ts (4 tests) 502ms
     âœ“ should create  325ms
stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should be created
FirebaseStateService: User is null or has no email, setting SignedOut state.

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should have a user signal that is initially null
FirebaseStateService: Persistence set to browserLocalPersistence

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should have a user signal that is initially null
FirebaseStateService: User is null or has no email, setting SignedOut state.

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call loginWithGoogle when login is called
FirebaseStateService: Persistence set to browserLocalPersistence

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call loginWithGoogle when login is called
FirebaseStateService: User is null or has no email, setting SignedOut state.

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call loginWithEmail when loginWithEmail is called
FirebaseStateService: Persistence set to browserLocalPersistence

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call loginWithEmail when loginWithEmail is called
FirebaseStateService: User is null or has no email, setting SignedOut state.

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call signupWithEmail when signupWithEmail is called
FirebaseStateService: Persistence set to browserLocalPersistence

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call signupWithEmail when signupWithEmail is called
FirebaseStateService: User is null or has no email, setting SignedOut state.

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call signOut when logout is called
FirebaseStateService: Persistence set to browserLocalPersistence

stdout | src/app/firebase-state.service.spec.ts > FirebaseStateService > should call signOut when logout is called
FirebaseStateService: User is null or has no email, setting SignedOut state.

 âœ“ src/app/firebase-state.service.spec.ts (6 tests) 28ms
stdout | src/app/member-edit/member-edit.spec.ts > MemberEditComponent > should call preventDefault and updateMember on save
Updating member {
  id: [32m'test-id'[39m,
  lastUpdated: [32m'2026-02-16T20:56:50.076Z'[39m,
  isAdmin: [33mfalse[39m,
  name: [32m'Test Member'[39m,
  address: [32m''[39m,
  city: [32m''[39m,
  zipCode: [32m''[39m,
  countyOrState: [32m''[39m,
  country: [32m'United States'[39m,
  phone: [32m''[39m,
  emails: [ [32m'test@example.com'[39m ],
  gender: [32m''[39m,
  dateOfBirth: [32m''[39m,
  publicEmail: [32m''[39m,
  publicPhone: [32m''[39m,
  publicRegionOrCity: [32m''[39m,
  publicCountyOrState: [32m''[39m,
  instructorWebsite: [32m''[39m,
  memberId: [32m'US001'[39m,
  sifuInstructorId: [32m''[39m,
  managingOrgId: [32m''[39m,
  membershipType: [32m'Annual'[39m,
  firstMembershipStarted: [32m''[39m,
  lastRenewalDate: [32m''[39m,
  currentMembershipExpires: [32m''[39m,
  instructorId: [32m''[39m,
  instructorLicenseExpires: [32m''[39m,
  instructorLicenseType: [32m'None'[39m,
  instructorLicenseRenewalDate: [32m''[39m,
  studentLevel: [32m''[39m,
  applicationLevel: [32m''[39m,
  mastersLevels: [],
  notes: [32m''[39m
}

 âœ“ src/app/school-members/school-members.spec.ts (1 test) 298ms
stdout | src/app/member-edit/member-edit.spec.ts > MemberEditComponent > should call addMember if member email is not present
Adding member {
  id: [32m''[39m,
  lastUpdated: [32m'2026-02-16T20:56:50.473Z'[39m,
  isAdmin: [33mfalse[39m,
  name: [32m'New Member'[39m,
  address: [32m''[39m,
  city: [32m''[39m,
  zipCode: [32m''[39m,
  countyOrState: [32m''[39m,
  country: [32m'United States'[39m,
  phone: [32m''[39m,
  emails: [],
  gender: [32m''[39m,
  dateOfBirth: [32m''[39m,
  publicEmail: [32m''[39m,
  publicPhone: [32m''[39m,
  publicRegionOrCity: [32m''[39m,
  publicCountyOrState: [32m''[39m,
  instructorWebsite: [32m''[39m,
  memberId: [90mundefined[39m,
  sifuInstructorId: [32m''[39m,
  managingOrgId: [32m''[39m,
  membershipType: [32m'Annual'[39m,
  firstMembershipStarted: [32m''[39m,
  lastRenewalDate: [32m''[39m,
  currentMembershipExpires: [32m''[39m,
  instructorId: [32m''[39m,
  instructorLicenseExpires: [32m''[39m,
  instructorLicenseType: [32m'None'[39m,
  instructorLicenseRenewalDate: [32m''[39m,
  studentLevel: [32m''[39m,
  applicationLevel: [32m''[39m,
  mastersLevels: [],
  notes: [32m''[39m
}

 âœ“ src/app/school-list/school-list.spec.ts (4 tests) 442ms
 âœ“ src/app/routing.utils.spec.ts (11 tests) 11ms
 âœ“ src/app/member-edit/member-edit.spec.ts (3 tests) 400ms
     âœ“ should create  352ms
stdout | src/app/searchable-set.spec.ts > SearchableSet > should perform search only on unique entries
membersMiniSearch computed, adding [33m1[39m entries

 âœ“ src/app/searchable-set.spec.ts (5 tests) 4ms
 âœ“ src/app/profile-menu/profile-menu.spec.ts (1 test) 86ms
 âœ“ src/app/import-export/import-export.spec.ts (3 tests) 107ms
 âœ“ src/app/import-export/import-schools/import-schools.component.spec.ts (3 tests) 194ms
 âœ“ src/app/import-export/import-export-utils.spec.ts (6 tests) 4ms
 âœ“ src/app/app.spec.ts (2 tests) 225ms
 âœ“ src/app/import-export/import-members/import-members.component.spec.ts (13 tests) 415ms
 â¯ src/app/import-export/import-orders/import-orders.component.spec.ts (17 tests | 3 failed) 1164ms
     âœ“ should create 68ms
       âœ“ should detect new orders 114ms
       âœ“ should detect existing orders (UPDATE) 105ms
       Ã— should detect duplicate orders within import file 108ms
       âœ“ should match member by External ID and update membership dates 104ms
       âœ“ should use the MAX of startDate, datePaid, and currentExpiry + 1yr for new expiry 104ms
       âœ“ should match member by Email if External ID is missing 104ms
       Ã— should flag ambiguous email 106ms
       âœ“ should update Instructor License dates 108ms
       âœ“ should match school by ID and update license dates 112ms
       Ã— should fail if School License order has no External ID 109ms
       âœ“ should show all items when filter is ALL 4ms
       âœ“ should filter by MEMBERSHIP 3ms
       âœ“ should filter by SCHOOL_LICENSE 4ms
       âœ“ should filter by INSTRUCTOR_LICENSE 3ms
       âœ“ should filter by OTHER 3ms
       âœ“ should calculate stats correctly 3ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 3 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/app/import-export/import-orders/import-orders.component.spec.ts > ImportOrdersComponent > Order Analysis > should detect duplicate orders within import file
AssertionError: expected [ Array(1) ] to include StringMatching{â€¦}
 â¯ src/app/import-export/import-orders/import-orders.component.spec.ts:131:32
    129|       const issues = delta.issues.filter(i => i.key === 'REF-DUP');
    130|       expect(issues.length).toBeGreaterThan(0);
    131|       expect(issues[0].issues).toContain(expect.stringMatching(/Duplicâ€¦
       |                                ^
    132|     });
    133|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/3]â¯

 FAIL  src/app/import-export/import-orders/import-orders.component.spec.ts > ImportOrdersComponent > Member Side Effects > should flag ambiguous email
AssertionError: expected [ Array(1) ] to include StringMatching /Ambiguous Email/
 â¯ src/app/import-export/import-orders/import-orders.component.spec.ts:220:29
    218|       const issue = delta.issues.find(i => i.key === 'REF-AMBIG');
    219|       expect(issue).toBeTruthy();
    220|       expect(issue!.issues).toContain(expect.stringMatching(/Ambiguousâ€¦
       |                             ^
    221|     });
    222| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/3]â¯

 FAIL  src/app/import-export/import-orders/import-orders.component.spec.ts > ImportOrdersComponent > School Side Effects > should fail if School License order has no External ID
AssertionError: expected [ Array(1) ] to include StringMatching{â€¦}
 â¯ src/app/import-export/import-orders/import-orders.component.spec.ts:291:29
    289|       const issue = delta.issues.find(i => i.key === 'REF-SCH-FAIL');
    290|       expect(issue).toBeTruthy();
    291|       expect(issue!.issues).toContain(expect.stringMatching(/School Liâ€¦
       |                             ^
    292|     });
    293|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/3]â¯


 Test Files  1 failed | 21 passed (22)
      Tests  3 failed | 91 passed (94)
   Start at  21:56:48
   Duration  4.31s (transform 7.28s, setup 9.26s, import 15.48s, tests 5.14s, environment 8.70s)

â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
